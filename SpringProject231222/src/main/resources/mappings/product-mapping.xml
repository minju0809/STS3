<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ProductDao">

	<select id="select_sql" parameterType="product" resultType="product">
		select * from tbl_product where 1=1 
		<if test="ch1=='product_name'">
			and product_name like '%'||#{ch2}||'%'
		</if>
		<if test="ch1=='product_desc'">
			and product_desc like '%'||#{ch2}||'%'
		</if>
		order by product_id
	</select>
	
	<select id="select1_sql" parameterType="product" resultType="product">
		select * from tbl_product where product_id = #{product_id}
	</select>
	
	<select id="selectId_sql" resultType="int">
	<!--	select seq_product.nextval from dual -->
	select max(product_id) + 1 from tbl_product
	</select>
	
	<insert id="insert_sql" parameterType="product">
		insert into tbl_product (product_id, product_name, product_price, product_desc, product_img)
		values (#{product_id}, #{product_name}, #{product_price}, #{product_desc}, #{product_img})
	</insert>
	
	<delete id="delete_sql" parameterType="product">
		delete from tbl_product where product_id = #{product_id}
	</delete>
	
	<update id="update_sql" parameterType="product">
		update tbl_product 
		set product_name = #{product_name}, product_price = #{product_price}, 
		product_desc = #{product_desc}, product_img = #{product_img} 
		where product_id = #{product_id}
	</update>
	
	<insert id="shopInsert_sql" parameterType="shop">
		insert into tbl_cart (cart_id, memberId, product_id, product_name, amount)
		values ((select max(cart_id) + 1 as cart_id from tbl_cart), #{memberId}, #{product_id}, #{product_name}, #{amount})
	</insert>
	
	<update id="shopUpdate_sql" parameterType="shop">
		update tbl_cart set amount = amount + #{amount}
		where memberId = #{memberId} and product_id = #{product_id}
	</update>
	
	<update id="shopTotalUpdate_sql" parameterType="shop">
		update tbl_cart set amount = #{amount}
		where cart_id = #{cart_id}
	</update>
	
	<select id="shopBuyCK_sql" parameterType="shop" resultType="shop">
		select * from tbl_cart where memberId=#{memberId} and product_id=#{product_id}
	</select>

	<select id="shopBuyList_sql" resultType="shop">
		select cart_id, memberId, c.product_id, c.product_name, c.amount, p.product_price, p.product_img
  	 	from tbl_cart c join tbl_product p on c.product_id=p.product_id
 	   	where c.memberId=#{memberId} order by c.cart_id desc
	</select>
	
	<delete id="shopDelete_sql" parameterType="shop">
		delete from tbl_cart where cart_id = #{cart_id}
	</delete>
	
	<delete id="shopTotalDelete_sql" parameterType="shop">
		delete from tbl_cart where memberId = #{memberId}
	</delete>
	
	
	<select id="orderIdx_sql" resultType="int">
		select orderIdx.nextval from dual
	</select>
	
	<insert id="orderMemberInsert_sql" parameterType="order">
		insert into orderMemberList (orderId, name, phone, etc)
		values (#{orderId}, #{name}, #{phone}, #{etc})
	</insert>
	
	<insert id="orderInsert_sql" parameterType="order">
		insert into orderList (orderId, cart_id, memberId, product_id, product_name, amount)
		values (#{orderId}, #{cart_id}, #{memberId}, #{product_id}, #{product_name}, #{amount})
	</insert>
	
	<select id="orderMemeberList_sql" parameterType="order" resultType="order">
		select * from orderMemberList order by orderId
	</select>
	
</mapper>
